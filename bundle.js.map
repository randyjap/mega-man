{"version":3,"sources":["webpack:///webpack/bootstrap 4a27f9e91fcf968193d2","webpack:///./entry.js","webpack:///./lib/game.js","webpack:///./lib/vector_util.js","webpack:///./lib/sprites.js","webpack:///./lib/levels.js","webpack:///./lib/canvas.js"],"names":["document","addEventListener","window","pause","runGame","restartButton","getElementById","e","preventDefault","canvas","cancelAnimationFrame","animation","body","removeChild","proxy","play","arrowCodes","Game","plan","grid","sprites","width","length","height","y","row","transformedRow","x","chr","fieldType","Sprite","characters","push","megaman","filter","player","type","boss","gameStatus","score","prototype","findCollision","pos","size","left","Math","floor","right","ceil","top","bottom","findOverlappingObject","i","other","maxStep","animate","step","keys","thisStep","min","forEach","act","spriteOverlapAction","sprite","hitPoints","hit","round","random","innerHTML","trackKeys","codes","pressed","Object","create","handler","event","hasOwnProperty","keyCode","down","runAnimation","frameFunc","lastTime","frame","time","stop","timeStep","requestAnimationFrame","arrows","start","level","Canvas","display","drawFrame","plans","VectorUtil","plus","times","factor","Henchman","Boss","Bullet","Megaman","gravity","jumpSpeed","megamanXSpeed","bossFiringRate","megamanFiringRate","speed","lastFire","Date","destroyed","moveY","game","motion","newPos","collidedObject","cFire","fireRight","otherSprite","bulletType","facingRight","moveX","up","shoot","levels","spriteSize","spriteRoll","createElement","src","flipHorizontally","context","around","translate","scale","parent","id","innerWidth","appendChild","cx","getContext","animationTime","viewport","clear","parentNode","updateViewport","clearDisplay","drawBackground","drawSprites","view","margin","center","max","console","log","fillStyle","fillRect","xPosition","yPosition","spriteFrameNumber","drawImage","farewellMessage","messageNumber","drawMegaMan","rectangle","Path2D","rect","stroke","save","restore","drawBoss","drawHenchman","henchman","drawBullet"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4a27f9e91fcf968193d2","import { play } from './lib/game.js';\nimport { levels } from './lib/levels.js';\nimport { Canvas } from './lib/canvas.js';\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  window.pause = false;\n  let runGame = play(levels, Canvas);\n  runGame();\n  let restartButton = document.getElementById(\"restart\");\n  restartButton.addEventListener(\"click\", e => {\n    e.preventDefault();\n\n    let canvas = document.getElementById(\"canvas\");\n    if (canvas) {\n      cancelAnimationFrame(window.animation);\n      document.body.removeChild(canvas);\n      runGame = play(levels, Canvas);\n      runGame();\n    } else {\n      runGame = play(levels, Canvas);\n      runGame();\n    }\n  });\n\n  let proxy = document.getElementById(\"pause\");\n  proxy.addEventListener(\"click\", e => {\n    e.preventDefault();\n    window.pause = !window.pause;\n    if (!window.pause) runGame();\n  });\n});\n\n\n\n// WEBPACK FOOTER //\n// ./entry.js","import { VectorUtil } from './vector_util';\nimport { Boss, Bullet, Megaman, Henchman } from './sprites';\n\nlet arrowCodes = { 65: \"left\", 87: \"up\", 68: \"right\", 32: \"shoot\" };\n\nfunction Game(plan) {\n  this.grid = [];\n  this.sprites = [];\n  this.width = plan[0].length;\n  this.height = plan.length;\n\n  for (let y = 0; y < this.height; y++) {\n    let row = plan[y], transformedRow = [];\n    for (let x = 0; x < this.width; x++) {\n      let chr = row[x];\n      let fieldType = null;\n      let Sprite = characters[chr];\n      if (Sprite)\n        this.sprites.push(new Sprite(new VectorUtil(x, y), chr));\n      else if (chr === \"#\")\n        fieldType = \"block\";\n      else if (chr === \"W\")\n        fieldType = \"water\";\n      transformedRow.push(fieldType);\n    }\n    this.grid.push(transformedRow);\n  }\n\n  this.megaman = this.sprites.filter(player => {\n    return player.type === \"megaman\";\n  })[0];\n\n  this.boss = this.sprites.filter(player => {\n    return player.type === \"boss\";\n  })[0];\n\n  this.gameStatus = null;\n  this.score = 0;\n}\n\nlet characters = {\n  \"M\": Megaman,\n  \"B\": Boss,\n  \"H\": Henchman\n};\n\nGame.prototype.findCollision = function(pos, size) {\n  let left = Math.floor(pos.x);\n  let right = Math.ceil(pos.x + size.x);\n  let top = Math.floor(pos.y);\n  let bottom = Math.ceil(pos.y + size.y);\n\n  if (left < 0 || right > this.width || top < 0) return \"block\";\n\n  for (let y = top; y < bottom; y++) {\n    for (let x = left; x < right; x++) {\n      let fieldType = this.grid[y][x];\n      if (fieldType) return fieldType;\n    }\n  }\n};\n\nGame.prototype.findOverlappingObject = function(player) {\n  for (let i = 0; i < this.sprites.length; i++) {\n    let other = this.sprites[i];\n    if (other !== player &&\n        player.pos.x + player.size.x > other.pos.x &&\n        player.pos.x < other.pos.x + other.size.x &&\n        player.pos.y + player.size.y > other.pos.y &&\n        player.pos.y < other.pos.y + other.size.y)\n      return other;\n  }\n};\n\nlet maxStep = 0.05;\n\nGame.prototype.animate = function(step, keys) {\n  while (step > 0) {\n    let thisStep = Math.min(step, maxStep);\n    this.sprites.forEach(function(player) {\n      player.act(thisStep, this, keys);\n    }, this);\n    step -= thisStep;\n  }\n};\n\nGame.prototype.spriteOverlapAction = function(type, player, sprite) {\n  if (type === \"water\" && this.gameStatus === null) {\n    if (this.megaman.hitPoints > 0) this.megaman.hitPoints -= 0.3;\n    if (this.megaman.hitPoints <= 0) {\n      this.gameStatus = \"lost\";\n    }\n    this.megaman.hit = true;\n  } else if (type === \"friendly-bullet\" && sprite && sprite.type === \"boss\" && this.gameStatus === null) {\n    sprite.hitPoints--;\n    this.score += Math.round(100000 * Math.random());\n    document.getElementById(\"score\").innerHTML = `Score: ${this.score}`;\n    sprite.hit = true;\n    if (sprite.hitPoints <= 0) {\n      this.gameStatus = \"won\";\n    }\n  } else if (type === \"friendly-bullet\" && sprite && sprite.type === \"henchman\" && this.gameStatus === null) {\n    if (sprite.hitPoints > 0) sprite.hitPoints--;\n    this.score += Math.round(100000 * Math.random());\n    document.getElementById(\"score\").innerHTML = `Score: ${this.score}`;\n    sprite.hit = true;\n  } else if (type === \"unfriendly-bullet\" && sprite && sprite.type === \"megaman\" && this.gameStatus === null) {\n    sprite.hitPoints--;\n    sprite.hit = true;\n    if (sprite.hitPoints <= 0) {\n      this.gameStatus = \"lost\";\n    }\n  }\n};\n\nfunction trackKeys(codes) {\n  let pressed = Object.create(null);\n  function handler(event) {\n    if (codes.hasOwnProperty(event.keyCode)) {\n      let down = event.type === \"keydown\";\n      pressed[codes[event.keyCode]] = down;\n      event.preventDefault();\n    }\n  }\n  addEventListener(\"keydown\", handler);\n  addEventListener(\"keyup\", handler);\n  return pressed;\n}\n\nfunction runAnimation(frameFunc) {\n  let lastTime = null;\n  function frame(time) {\n    let stop = false;\n    if (lastTime !== null) {\n      let timeStep = Math.min(time - lastTime, 100) / 1000;\n      stop = (frameFunc(timeStep) === false);\n    }\n    lastTime = time;\n    if (!stop)\n      window.animation = requestAnimationFrame(frame);\n  }\n  requestAnimationFrame(frame);\n}\n\nlet arrows = trackKeys(arrowCodes);\n\nfunction start(level, Canvas) {\n  let display = new Canvas(document.body, level);\n  window.display = display;\n  let runGame = () => {\n    runAnimation(function(step) {\n      level.animate(step, arrows);\n      display.drawFrame(step);\n      return !window.pause;\n    });\n  };\n  return runGame;\n}\n\nexport function play(plans, Canvas) {\n  return start(new Game(plans[0]), Canvas);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/game.js","export function VectorUtil(x, y) {\n  this.x = x; this.y = y;\n}\nVectorUtil.prototype.plus = function(other) {\n  return new VectorUtil(this.x + other.x, this.y + other.y);\n};\nVectorUtil.prototype.times = function(factor) {\n  return new VectorUtil(this.x * factor, this.y * factor);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./lib/vector_util.js","import { VectorUtil } from './vector_util';\n\nlet gravity = 45;\nlet jumpSpeed = 18;\nlet megamanXSpeed = 6;\nlet bossFiringRate =  4 / 3;\nlet megamanFiringRate = 1 / 3;\n\nexport function Henchman(pos) {\n  this.pos = pos.plus(new VectorUtil(0, 0));\n  this.size = new VectorUtil(1, 1);\n  this.speed = new VectorUtil(0, 0);\n  this.hitPoints = 20;\n  this.lastFire = new Date();\n  this.hit = false;\n  this.destroyed = false;\n}\n\nHenchman.prototype.type = \"henchman\";\n\nHenchman.prototype.moveY = function(step, game) {\n  this.speed.y += step * gravity;\n  let motion = new VectorUtil(0, this.speed.y * step);\n  let newPos = this.pos.plus(motion);\n  let collidedObject = game.findCollision(newPos, this.size);\n  if (collidedObject) {\n    game.spriteOverlapAction(collidedObject);\n    if (this.hitPoints > 0 && this.speed.y > 0) {\n      this.speed.y = 0;\n      this.speed.y = -(Math.random() * (20 - 5) + 5);\n    } else {\n      this.speed.y = 0;\n    }\n  } else {\n    this.pos = newPos;\n  }\n};\n\nHenchman.prototype.act = function(step, game) {\n  this.moveY(step, game);\n\n  // this will slow down the firing rate to 3 a second\n  if (!this.destroyed) {\n    let cFire = new Date();\n    if (((cFire - this.lastFire) / 1000) > bossFiringRate){\n      let fireRight = true;\n      if (this.pos.x > game.megaman.pos.x) fireRight = false;\n      game.sprites.push(new Bullet(new VectorUtil(this.pos.x, this.pos.y), \"unfriendly-bullet\", fireRight));\n      this.lastFire = cFire;\n    }\n  }\n\n  let otherSprite = game.findOverlappingObject(this);\n  if (otherSprite) {\n    game.spriteOverlapAction(otherSprite.type, otherSprite, this);\n  } else {\n    this.hit = false;\n  }\n};\n\nexport function Boss(pos) {\n  this.pos = pos.plus(new VectorUtil(0, 0));\n  this.size = new VectorUtil(1, 1);\n  this.speed = new VectorUtil(0, 0);\n  this.hitPoints = 100;\n  this.lastFire = new Date();\n  this.hit = false;\n  this.destroyed = false;\n}\n\nBoss.prototype.type = \"boss\";\n\nBoss.prototype.moveY = function(step, game) {\n  this.speed.y += step * gravity;\n  let motion = new VectorUtil(0, this.speed.y * step);\n  let newPos = this.pos.plus(motion);\n  let collidedObject = game.findCollision(newPos, this.size);\n  if (collidedObject) {\n    game.spriteOverlapAction(collidedObject);\n    if (this.hitPoints > 0 && this.speed.y > 0) {\n      this.speed.y = 0;\n      this.speed.y = -(Math.random() * (20 - 5) + 5);\n    } else {\n      this.speed.y = 0;\n    }\n  } else {\n    this.pos = newPos;\n  }\n};\n\nBoss.prototype.act = function(step, game) {\n  this.moveY(step, game);\n\n  // this will slow down the firing rate to 3 a second\n  if (!this.destroyed) {\n    let cFire = new Date();\n    if (((cFire - this.lastFire) / 1000) > bossFiringRate){\n      let fireRight = true;\n      if (this.pos.x > game.megaman.pos.x) fireRight = false;\n      game.sprites.push(new Bullet(new VectorUtil(this.pos.x, this.pos.y), \"unfriendly-bullet\", fireRight));\n      this.lastFire = cFire;\n    }\n  }\n\n  let otherSprite = game.findOverlappingObject(this);\n  if (otherSprite) {\n    game.spriteOverlapAction(otherSprite.type, otherSprite, this);\n  } else {\n    this.hit = false;\n  }\n\n  if (game.gameStatus === \"won\") {\n    this.destroyed = true;\n  }\n};\n\nexport function Bullet(pos, bulletType, fireRight) {\n  this.pos = pos.plus(new VectorUtil(0, 0));\n  this.size = new VectorUtil(1, 1);\n  if (fireRight === true) {\n    this.speed = new VectorUtil(10, 0);\n  } else if (fireRight === false) {\n    this.speed = new VectorUtil(-10, 0);\n  } else if (window.display.facingRight) {\n    this.speed = new VectorUtil(-10, 0);\n  } else {\n    this.speed = new VectorUtil(10, 0);\n  }\n  this.type = bulletType;\n}\n\nBullet.prototype.moveX = function(step, game, keys) {\n  let motion = new VectorUtil(this.speed.x * step, 0);\n  let newPos = this.pos.plus(motion);\n  this.pos = newPos;\n};\n\nBullet.prototype.act = function(step, game) {\n  this.moveX(step, game);\n};\n\nexport function Megaman(pos) {\n  this.pos = pos.plus(new VectorUtil(0, 0));\n  this.size = new VectorUtil(1, 1);\n  this.speed = new VectorUtil(0, 0);\n  this.lastFire = new Date();\n  this.hitPoints = 50;\n  this.hit = false;\n}\n\nMegaman.prototype.type = \"megaman\";\n\nMegaman.prototype.moveX = function(step, game, keys) {\n  this.speed.x = 0;\n  if (keys.left) this.speed.x -= megamanXSpeed;\n  if (keys.right) this.speed.x += megamanXSpeed;\n\n  let motion = new VectorUtil(this.speed.x * step, 0);\n  let newPos = this.pos.plus(motion);\n  let collidedObject = game.findCollision(newPos, this.size);\n  if (collidedObject) {\n    game.spriteOverlapAction(collidedObject);\n  } else if (this.hitPoints > 0) {\n    this.hit = false;\n    this.pos = newPos;\n  }\n};\n\nMegaman.prototype.moveY = function(step, game, keys) {\n  this.speed.y += step * gravity;\n  let motion = new VectorUtil(0, this.speed.y * step);\n  let newPos = this.pos.plus(motion);\n  let collidedObject = game.findCollision(newPos, this.size);\n  if (collidedObject) {\n    game.spriteOverlapAction(collidedObject);\n    if (keys.up && this.speed.y > 0) {\n      this.speed.y = -jumpSpeed;\n    } else {\n      this.speed.y = 0;\n    }\n  } else if (this.hitPoints > 0) {\n    this.pos = newPos;\n  }\n};\n\nMegaman.prototype.act = function(step, game, keys) {\n  this.moveX(step, game, keys);\n  this.moveY(step, game, keys);\n  if (keys.shoot && this.hitPoints > 0) {\n    // this will slow down the firing rate to 3 a second\n    let cFire = new Date();\n    if (((cFire - this.lastFire) / 1000) > megamanFiringRate){\n      game.sprites.push(new Bullet(new VectorUtil(this.pos.x, this.pos.y), \"friendly-bullet\"));\n      this.lastFire = cFire;\n    }\n  }\n\n  let otherSprite = game.findOverlappingObject(this);\n  if (otherSprite) {\n    game.spriteOverlapAction(otherSprite.type, otherSprite, this);\n  }\n\n  // Losing animation\n  if (game.gameStatus === \"lost\") {\n    this.hit = true;\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./lib/sprites.js","export let levels = [\n  [\"                                                                                \",\n   \"                                                                                \",\n   \"                                                                                \",\n   \"                                                                           B    \",\n   \"                                                     H     #####################\",\n   \"                                                   #####                        \",\n   \"                                       H    ####                                \",\n   \"                                 H   ####                                       \",\n   \"                         H    #####          ####      ####     ####   ####     \",\n   \"                   H   ####           ####                                      \",\n   \"     M           ####                             ####                          \",\n   \"WW############WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW\",\n   \"                                                                                \",]\n ];\n\n\n\n// WEBPACK FOOTER //\n// ./lib/levels.js","let spriteSize = 50;\nlet spriteRoll = document.createElement(\"img\");\nspriteRoll.src = \"images/megaman.png\";\n\nfunction flipHorizontally(context, around) {\n  context.translate(around, 0);\n  context.scale(-1, 1);\n  context.translate(-around, 0);\n}\n\nexport function Canvas(parent, game) {\n  this.canvas = document.createElement(\"canvas\");\n  this.canvas.id = \"canvas\";\n  this.canvas.width = Math.min(window.innerWidth, game.width * spriteSize);\n  this.canvas.height = Math.min(window.innerWidth / 3, game.height * spriteSize);\n  parent.appendChild(this.canvas);\n  this.cx = this.canvas.getContext(\"2d\");\n\n  this.game = game;\n  this.animationTime = 0;\n  this.facingRight = false;\n\n  this.viewport = {\n    top: 0,\n    left: 0,\n    height: this.canvas.height / spriteSize,\n    width: this.canvas.width / spriteSize\n  };\n\n  this.start = new Date();\n  this.drawFrame(0);\n}\n\nCanvas.prototype.clear = function() {\n  this.canvas.parentNode.removeChild(this.canvas);\n};\n\nCanvas.prototype.drawFrame = function(step) {\n  this.animationTime += step;\n\n  this.updateViewport();\n  this.clearDisplay();\n  this.drawBackground();\n  this.drawSprites();\n};\n\nCanvas.prototype.updateViewport = function() {\n  let view = this.viewport, margin = view.width / 6;\n  let megaman = this.game.megaman;\n  let center = megaman.pos.plus(megaman.size.times(0.5));\n\n  if (center.x < view.left + margin * 2) {\n    view.left = Math.max(center.x - margin * 2, 0);\n  }  else if (center.x > view.left + view.width - margin * 2) {\n    view.left = Math.min(center.x + margin * 2 - view.width, this.game.width - view.width);\n  }\n\n  if (center.y < view.top + margin) {\n    view.top = Math.max(center.y - margin, 0);\n  }  else if (center.y > view.top + view.height - margin) {\n    view.top = Math.min(center.y + margin - view.height, this.game.height - view.height);\n  }\n};\n\nCanvas.prototype.clearDisplay = function() {\n  if (this.game.gameStatus === \"won\") {\n    //TODO\n    console.log(\"YOU WON!\");\n  } else if (this.game.gameStatus === \"lost\") {\n    //TODO\n    console.log(\"YOU LOST!\");\n  } else {\n    this.cx.fillStyle = \"lightblue\";\n  }\n  // Don't forget to make things transparent!\n  this.cx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n};\n\nCanvas.prototype.drawBackground = function() {\n  let view = this.viewport;\n  let left = Math.floor(view.left);\n  let right = Math.ceil(view.left + view.width);\n  let top = Math.floor(view.top);\n  let bottom = Math.ceil(view.top + view.height);\n\n  for (let y = top; y < bottom; y++) {\n    for (let x = left; x < right; x++) {\n      let fieldType = this.game.grid[y][x];\n      if (fieldType === null) continue;\n      let xPosition = (x - view.left) * spriteSize;\n      let yPosition = (y - view.top) * spriteSize;\n\n      let spriteFrameNumber;\n      if (fieldType === \"water\") spriteFrameNumber = 16;\n      if (fieldType === \"block\") spriteFrameNumber = 15;\n\n      this.cx.drawImage(\n        spriteRoll,\n        (spriteFrameNumber * spriteSize), 0, spriteSize, spriteSize,\n        xPosition, yPosition, spriteSize, spriteSize\n      );\n    }\n  }\n\n  let farewellMessage = document.createElement(\"img\");\n  farewellMessage.src = \"images/win-loss.png\";\n  let messageNumber;\n\n  if (this.game.gameStatus === \"lost\") {\n    messageNumber = 1;\n    this.cx.drawImage(\n      farewellMessage,\n      (messageNumber * 400), 0,\n      400, 200,\n      400 + (right - left) / 2, 100 + (bottom - top) / 2,\n      400, 200\n    );\n  } else if (this.game.gameStatus === \"won\") {\n    messageNumber = 0;\n    this.cx.drawImage(\n      farewellMessage,\n      (messageNumber * 400), 0,\n      400, 200,\n      400 + (right - left) / 2, 100 + (bottom - top) / 2,\n      400, 200\n    );\n  } else if (new Date() - this.start < 7000) {\n    messageNumber = 2;\n    this.cx.drawImage(\n      farewellMessage,\n      (messageNumber * 400), 0,\n      400, 200,\n      400 + (right - left) / 2, 100 + (bottom - top) / 2,\n      400, 200\n    );\n  }\n};\n\nCanvas.prototype.drawMegaMan = function(x, y, width, height) {\n  let spriteFrameNumber = 0;\n  let megaman = this.game.megaman;\n\n  if (megaman.hitPoints > 0 && megaman.hitPoints < 50) megaman.hitPoints += 0.02;\n\n  document.getElementById(\"megaman-health\").innerHTML = `Megaman Health: ${Math.round(megaman.hitPoints)}`;\n\n  if (megaman.speed.x !== 0) this.facingRight = megaman.speed.x < 0;\n\n  if (megaman.hit) {\n    spriteFrameNumber = 14;\n  } else if (megaman.speed.y !== 0) {\n    spriteFrameNumber = 11;\n  } else if (megaman.speed.x !== 0) {\n    spriteFrameNumber = Math.floor(this.animationTime * 12) % 10 + 1;\n  }\n\n  let rectangle = new Path2D();\n  rectangle.rect(x, y - 20, 50 * megaman.hitPoints / 50, 20);\n  this.cx.stroke(rectangle);\n  this.cx.save(); //keep drawing context intact\n\n  if (this.facingRight) flipHorizontally(this.cx, x + width / 2);\n  this.cx.drawImage(\n    spriteRoll,\n    (spriteFrameNumber * width), 0,\n    width, height,\n    x, y, width, height\n  );\n\n  this.cx.restore(); //restore drawing context\n\n};\n\nCanvas.prototype.drawBoss = function(x, y, width, height) {\n  let spriteFrameNumber = 13;\n  let boss = this.game.boss;\n  if (boss.destroyed) {\n    spriteFrameNumber = [17, 18][Math.floor(Math.random() * [17, 18].length)];\n  } else if (boss.hit) {\n    spriteFrameNumber = [17, 18][Math.floor(Math.random() * [17, 18].length)];\n  }\n\n  if (!boss.destroyed && boss.hitPoints < 100) boss.hitPoints += 0.02;\n  document.getElementById(\"boss-health\").innerHTML = `Boss Health: ${Math.round(boss.hitPoints)}`;\n\n  if (!boss.destroyed) {\n    let rectangle = new Path2D();\n    rectangle.rect(x, y - 20, 50 * boss.hitPoints / 50, 20);\n    this.cx.stroke(rectangle);\n  }\n\n  this.cx.save(); //keep drawing context intact\n  if (this.game.megaman.pos.x > this.game.boss.pos.x) flipHorizontally(this.cx, x + width / 2);\n\n  this.cx.drawImage(\n    spriteRoll,\n    (spriteFrameNumber * width), 0,\n    width, height,\n    x, y, width, height\n  );\n\n  this.cx.restore(); //restore drawing context\n};\n\nCanvas.prototype.drawHenchman = function(x, y, width, height, henchman) {\n  if (!henchman.destroyed) {\n    let spriteFrameNumber = 20;\n    if (henchman.hitPoints <= 0) henchman.destroyed = true;\n    if (henchman.hit) {\n      spriteFrameNumber = [17, 20][Math.floor(Math.random() * [17, 20].length)];\n    }\n\n    let rectangle = new Path2D();\n    rectangle.rect(x, y - 20, 45 * henchman.hitPoints / 20, 20);\n    this.cx.stroke(rectangle);\n\n    this.cx.save(); //keep drawing context intact\n    if (this.game.megaman.pos.x > henchman.pos.x) flipHorizontally(this.cx, x + width / 2);\n\n\n    this.cx.drawImage(\n      spriteRoll,\n      (spriteFrameNumber * width), 0,\n      width, height,\n      x, y, width, height\n    );\n\n    this.cx.restore(); //restore drawing context\n  }\n};\n\nCanvas.prototype.drawBullet = function(x, y, width, height) {\n  let spriteFrameNumber = 12;\n  this.cx.drawImage(\n    spriteRoll,\n    (spriteFrameNumber * width), 0,\n    width, height,\n    x, y, width, height\n  );\n};\n\nCanvas.prototype.drawSprites = function() {\n  this.game.sprites.forEach(function(sprite) {\n    let width = sprite.size.x * spriteSize;\n    let height = sprite.size.y * spriteSize;\n    let x = (sprite.pos.x - this.viewport.left) * spriteSize;\n    let y = (sprite.pos.y - this.viewport.top) * spriteSize;\n    if (sprite.type === \"megaman\") {\n      this.drawMegaMan(x, y, width, height);\n    } else if (sprite.type === \"boss\"){\n      this.drawBoss(x, y, width, height);\n    } else if (sprite.type === \"henchman\"){\n      this.drawHenchman(x, y, width, height, sprite);\n    } else if (sprite.type === \"friendly-bullet\"){\n      this.drawBullet(x, y, width, height);\n    } else if (sprite.type === \"unfriendly-bullet\"){\n      this.drawBullet(x, y, width, height);\n    }\n  }, this);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./lib/canvas.js"],"sourceRoot":""}